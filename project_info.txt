# Simple LLM Chatbot v2

## Project Information

### Project Overview
This is a simple chatbot application built with Python, FastAPI, and TinyDB. The chatbot is designed to assist with pre-sales inquiries for a software development company, providing guidance on budgets and timelines for different types of projects.

### Project Structure
- `/app`: Core application code
  - `main.py`: FastAPI application entry point
  - `chat_handler.py`: Handles chat messages and conversation flow
  - `llm_handler.py`: Interfaces with language models via LiteLLM
  - `database_handler.py`: Manages TinyDB database operations
  - `guidance_tools.py`: Tools for retrieving budget and timeline guidance
  - `db_init.py`: Initializes the database with seed data
  - `test_langflow.py`: Test script for verifying LangFlow pipeline setup
- `/data`: Data storage
  - `seed_data.json`: Seed data for initializing the database
  - `chatbot_db.json`: TinyDB database file
- `/docs`: Documentation
  - `/api`: API documentation
  - `/design`: Design documentation
  - `/test`: Test documentation
  - `/development`: Development documentation
  - `/usage`: Usage documentation
- `/tests`: Test code
  - `/unit`: Unit tests
  - `/integration`: Integration tests
  - `/e2e`: End-to-end tests
- `/static`: Static files for the web interface
- `/templates`: HTML templates for the web interface

### Key Features
- Natural language conversation with users
- Budget and timeline guidance for different project types
- Lead information extraction from conversations
- Persistent storage of leads and conversations
- Web interface for interacting with the chatbot

### Technologies Used
- Python 3.11
- FastAPI
- TinyDB
- LiteLLM
- Jinja2 Templates
- HTML/CSS/JavaScript

### Environment Variables
- `LLM_API_KEY`: API key for the LLM provider (OpenAI, Anthropic, etc.)
- `LLM_PROVIDER`: Provider to use (default: openai)
- `LLM_MODEL`: Model to use (default: gpt-4o-mini)
- `TINYDB_PATH`: Path to TinyDB database file
- `LANGFLOW_API_URL`: URL for the LangFlow API
- `PORT`: Port for the FastAPI server
- `HOST`: Host for the FastAPI server
- `DEBUG`: Debug mode for the FastAPI server
- `SESSION_EXPIRY_MINUTES`: Session expiry time in minutes

## Changelog

### 2025-03-04
- Initial project setup
- Created FastAPI application structure
- Implemented basic chat handler

### 2025-03-05
- Added LiteLLM integration
- Implemented conversation history management
- Created web interface
- Added budget and timeline guidance tools
- Implemented lead extraction logic
- Added TinyDB integration for data persistence
- Added unit and integration tests
- Improved error handling
- Enhanced documentation
- Removed Firebase-related files and dependencies
- Updated environment variable handling
- Improved error logging
- Fixed database initialization issues
- Improved path handling for database files
- Enhanced logging for better debugging
- Updated all documentation files to replace Firebase references with TinyDB
- Renamed firebase_integration.md to tinydb_integration.md
- Updated test files to use DatabaseHandler instead of FirebaseHandler
- Added test_langflow.py script for verifying LangFlow pipeline setup
- Created .env.example file with sample configurations
- Updated lead extraction test to better handle pattern matching
- Enhanced lead extraction using LiteLLM for entity extraction instead of regex patterns
- Added mock for LiteLLM entity extraction in tests for more reliable testing

## Getting Started

### Prerequisites
- Python 3.11 or higher
- API key for OpenAI or other LLM provider

### Installation
1. Clone the repository
2. Create a virtual environment: `python -m venv venv`
3. Activate the virtual environment:
   - Windows: `venv\Scripts\activate`
   - Unix/MacOS: `source venv/bin/activate`
4. Install dependencies: `pip install -r requirements.txt`
5. Copy `.env.example` to `.env` and update with your API keys
6. Initialize the database: `python app/db_init.py`

### Running the Application
1. Start the server: `uvicorn app.main:app --reload`
2. Open a web browser and navigate to `http://localhost:8000`

### Running Tests
- Run all tests: `pytest`
- Run unit tests: `pytest tests/unit`
- Run integration tests: `pytest tests/integration`
- Run end-to-end tests: `pytest tests/e2e`
- Test LangFlow pipeline: `python app/test_langflow.py`

## Project Structure
- `/app`: Main application code
  - `main.py`: FastAPI application entry point
  - `chat_handler.py`: Handles chat processing and LLM integration
  - `database_handler.py`: TinyDB integration for data storage
  - `guidance_tools.py`: Tools for retrieving budget and timeline guidance
  - `db_init.py`: Database initialization script
  - `test_langflow.py`: Test script for LangFlow pipeline
  - `/langflow`: LangFlow pipeline implementation
  - `/static`: Frontend assets (CSS, JS, images)
  - `/templates`: Frontend HTML templates
- `/data`: Data files
  - `seed_data.json`: Initial seed data for the database
- `/docs`: Project documentation
  - `/design`: Design documentation
  - `/api`: API documentation
  - `/test`: Test documentation
  - `/development`: Development guides
  - `/usage`: Usage guides
- `/tests`: Test files
  - `test_tinydb.py`: Test script for TinyDB implementation
  - `/unit`: Unit tests
  - `/integration`: Integration tests
  - `/e2e`: End-to-end tests
- `/venv`: Python virtual environment (Python 3.11)
- `.env`: Environment variables (created from .env.example)
- `.env.example`: Example environment variables
- `requirements.txt`: Project dependencies

## Requirements
- Python 3.11
- FastAPI
- Uvicorn
- LiteLLM
- TinyDB
- Pydantic
- LangFlow

## Development Roadmap
1. Environment Setup (Completed)
2. Core Components Implementation (Completed)
   - Implement chat handler
   - Implement TinyDB integration
   - Implement guidance tools
3. LangFlow Pipeline Setup (Completed)
4. FastAPI Backend Development (In Progress)
5. Frontend Implementation (In Progress)
6. Testing and Refinement (In Progress)

## Notes
- The project uses Python 3.11 for compatibility with all dependencies
- LiteLLM is used for LLM integration
- TinyDB is used for local data storage
- FastAPI is used for the backend
- LangFlow is used for the pipeline implementation
- Database files are excluded from version control to prevent conflicts
- Seed data is provided for initial database setup
- API keys must be set in the .env file before running the application
- The .env.example file provides a template for required environment variables 